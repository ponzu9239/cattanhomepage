<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãã‚ƒãŸã‚“ã®ãƒ“ãƒ³ã‚´ã‚²ãƒ¼ãƒ </title>
  
  <link rel="icon" href="IMG_4666.png" type="image/png">
  <meta property="og:image" content="https://www.yourwebsite.com/ç„¡é¡Œ12_20250907003655.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <link rel="stylesheet" href="common.css">
  
  <style>
    /* å‚åŠ è€…ãƒšãƒ¼ã‚¸ã¨ã—ã¦ã€ç®¡ç†è€…ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ã®CSS */
    #drawButton, #resetButton {
      display: none !important;
    }
    /* ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚‚éè¡¨ç¤ºã«ã™ã‚‹ */
    .bingo-buttons-container {
        display: none !important;
    }
    /* ãƒœã‚¿ãƒ³å‰Šé™¤ã«ä¼´ã„ã€ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
    #bingoDisplay {
      padding-bottom: 3rem; 
    }
  </style>

</head>

<body>
  <div id="header-placeholder"></div>

  <main>
    <section id="bingo">
      <h3>ğŸ“¢ ç™ºè¡¨ä¸­ã®ç•ªå· ğŸ“¢</h3>

      <div id="bingoDisplay">
        <p style="font-size: 1.2rem; margin-bottom: 0.5rem; color: #5aa2aa;">ç¾åœ¨ã®è¡¨ç¤ºç•ªå·</p>
        <div id="latestNumber">--</div>

        <div class="bingo-buttons-container">
            <button id="drawButton"></button>
            <button id="resetButton"></button>
        </div>
        
        <h4 style="color: #1b656f; border-bottom: 1px solid #ccc; padding-bottom: 0.3rem; margin-top: 2rem;">å‡ºãŸç•ªå·ä¸€è¦§ (1ã€œ75)</h4>
        <div id="numberBoard">
          </div>
      </div>
    </section>
  </main>

  <div id="footer-placeholder"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script src="common.js"></script>

  <script>
    // ----------------------------------------------------------------------
    // ğŸ¨ Firebaseè¨­å®š
    // ----------------------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyBWaCw2nAEh6FbYbteNk_fBSqPBTZ_UhC8",
      authDomain: "catiffanygame.firebaseapp.com",
      databaseURL: "https://catiffanygame-default-rtdb.firebaseio.com",
      projectId: "catiffanygame",
      storageBucket: "catiffanygame.firebasestorage.app",
      messagingSenderId: "166871605809",
      appId: "1:166871605809:web:1fe6e874fa06005ec46b10",
      measurementId: "G-ZNGEZZWMTP"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const bingoRef = db.ref('bingo'); 

    const maxNumber = 75;
    const latestNumberEl = document.getElementById('latestNumber');
    const numberBoardEl = document.getElementById('numberBoard');

    // å‰å›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®šç”¨)
    let lastDrawnNumbers = []; 

    // ãƒœãƒ¼ãƒ‰ã®æç”»å‡¦ç†
    function renderBoard(drawnNumbers, currentDisplay) {
        // --- æœ€æ–°è¡¨ç¤ºã®æ›´æ–° ---
        latestNumberEl.textContent = currentDisplay !== '--' ? currentDisplay : '--';
        
        // æŠ½é¸ä¸­ã‹ã©ã†ã‹ã®åˆ¤æ–­
        const isDrawing = !drawnNumbers.includes(parseInt(currentDisplay)) && currentDisplay !== '--';
        
        if (isDrawing) {
            latestNumberEl.classList.add('drawing');
        } else {
            latestNumberEl.classList.remove('drawing');
        }
        
        // **********************************************
        // â˜… ç¢ºå®šæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®š â˜…
        // **********************************************
        const latestNumInt = parseInt(currentDisplay);
        
        // æ–°ã—ã„ç•ªå·ãŒç¢ºå®šã—ãŸã‹ã©ã†ã‹ã®åˆ¤å®š (NaNã§ãªã„ã“ã¨ã‚‚ç¢ºèª)
        const isNewDrawn = drawnNumbers.includes(latestNumInt) && !lastDrawnNumbers.includes(latestNumInt) && !isNaN(latestNumInt);
        
        
        // --- ãƒœãƒ¼ãƒ‰ã®æ›´æ–° ---
        // ãƒœãƒ¼ãƒ‰ã‚’ç©ºã«ã—ã¦å†æç”»
        numberBoardEl.innerHTML = '';
        
        for (let i = 1; i <= maxNumber; i++) {
            const cell = document.createElement('div');
            cell.className = 'bingo-cell';
            // â˜… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®IDä»˜ä¸ãŒå¿…é ˆ â˜…
            cell.id = `cell-${i}`; 
            cell.setAttribute('data-content', i);
            
            if (drawnNumbers.includes(i)) {
                cell.classList.add('drawn');
                
                // â˜… ç¢ºå®šã—ãŸã‚»ãƒ«ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ  â˜…
                if (isNewDrawn && i === latestNumInt) {
                    cell.classList.add('stop-flash');
                }
            }
            
            numberBoardEl.appendChild(cell);

            if (i % 10 === 0 && i < maxNumber) {
                const breakEl = document.createElement('div');
                breakEl.className = 'break';
                numberBoardEl.appendChild(breakEl);
            }
        }
        
        // **********************************************
        // â˜… ç¢ºå®šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã¨è§£é™¤ï¼ˆç•ªå·ã‚¨ãƒªã‚¢ï¼‰ â˜…
        // **********************************************
        if (isNewDrawn) {
            // 1. æœ€æ–°ç•ªå·ã‚¨ãƒªã‚¢ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            latestNumberEl.classList.add('stop-highlight');
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è§£é™¤ (0.5ç§’å¾Œã«å®Ÿè¡Œ)
            setTimeout(() => {
                latestNumberEl.classList.remove('stop-highlight');
                
                // **é‡è¦**: ãƒœãƒ¼ãƒ‰å´ã® stop-flash ã‚¯ãƒ©ã‚¹ã¯ã€å†æç”»æ™‚ã«ä¸€åº¦ã ã‘ä»˜ä¸ã•ã‚Œã€CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«è‡ªå‹•çš„ã«æ¶ˆãˆã‚‹ãŸã‚ã€JSã§æ¶ˆã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                // ãŸã ã—ã€å¿µã®ãŸã‚ã€ç¢ºå®Ÿã«æ¶ˆã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€
                // ä»Šå›ã¯å†æç”»ã§æ¯å›DOMãŒç½®ãæ›ã‚ã‚‹ãŸã‚ã€ã“ã®setTimeoutå†…ã§ã®ãƒœãƒ¼ãƒ‰ã‚»ãƒ«å‰Šé™¤ã¯ä¸è¦ã§ã™ã€‚
                
                // const finalCell = document.getElementById(`cell-${latestNumInt}`); 
                // if (finalCell) {
                //     finalCell.classList.remove('stop-flash');
                // }
            }, 500);
        }

        // ç¢ºå®šç•ªå·ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        lastDrawnNumbers = drawnNumbers;
    }

    // Firebaseã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã—ã€ç”»é¢ã‚’è‡ªå‹•æ›´æ–°
    bingoRef.on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const drawnNumbers = data.drawnNumbers || [];
        const currentDisplay = data.currentDisplay || '--'; 

        renderBoard(drawnNumbers, currentDisplay);
    }, (error) => {
        console.error("Firebaseã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å—ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
    });
    
    document.addEventListener("DOMContentLoaded", () => {
        setupHeader('header-user.html');
    });

  </script>
</body>

</html>
