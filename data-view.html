<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>APEX è©¦åˆçµæœé–²è¦§</title>
  <style>
    body {
      font-family: "Hiragino Maru Gothic ProN", sans-serif;
      background-color: #f7fcfc;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 500px;
      margin: 30px auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    h1 {
      text-align: center;
      color: #47b6a2;
      margin-bottom: 20px;
    }

    .match-search {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .match-search input {
      width: 80px;
      padding: 8px;
      border: 1px solid #97eadb;
      border-radius: 6px;
      text-align: center;
    }

    .match-search button {
      padding: 8px 15px;
      background-color: #97eadb;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .match-search button:hover {
      background-color: #7dd2c3;
    }

    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }

    .navigation-buttons button {
      flex-grow: 1;
      padding: 10px;
      background-color: #97eadb;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .navigation-buttons button:hover {
      background-color: #7dd2c3;
    }

    .teams {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
    }

    .team-box {
      background: #eefaff;
      padding: 10px;
      border-radius: 8px;
      border: 2px solid #97eadb;
      position: relative;
    }

    .team-box.team2 {
      background: #fff1f5;
      border-color: #ffb6c1;
    }
    
    .team-box.winner {
      border-color: #ffc107;
      box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }
    
    .team-box.winner .kills, .team-box.winner h2 {
      color: #ffc107;
    }

    .winner-mark {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 24px;
      color: #ffc107;
      font-weight: bold;
    }
    
    .team-box h2 {
      text-align: center;
      font-size: 16px;
      margin: 0 0 8px 0;
      color: #47b6a2;
    }

    .team-box.team2 h2 {
      color: #ffb6c1;
    }

    .player-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .player-list li {
      background: #fff;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      padding: 6px;
      text-align: center;
    }

    .kills {
      font-size: 24px;
      font-weight: bold;
      color: #47b6a2;
      margin-top: 5px;
    }

    .team-box.team2 .kills {
      color: #ffb6c1;
    }

    .match-number {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    #loading-status {
      text-align: center;
      color: #666;
      margin-top: 20px;
    }

    .auto-update-option {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 5px;
      margin-top: 10px;
      margin-bottom: -10px;
    }
    
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body>
  <div class="container">
    <h1>è©¦åˆçµæœé–²è¦§</h1>

    <div class="match-search">
      <label for="match-no-input">è©¦åˆç•ªå·ï¼š</label>
      <input type="number" id="match-no-input" placeholder="ç•ªå·ã‚’å…¥åŠ›" min="1" />
      <button onclick="goToMatchNumber()">è¡¨ç¤º</button>
    </div>

    <div class="auto-update-option">
      <label for="auto-update-checkbox">æœ€æ–°ã®è©¦åˆã‚’è¦‹ã‚‹</label>
      <input type="checkbox" id="auto-update-checkbox" checked>
    </div>

    <div id="loading-status">è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="match-view" style="display: none;">
      <p class="match-number">è©¦åˆç•ªå·ï¼š<span id="match-no"></span></p>
      <div class="teams">
        <div class="team-box team1" id="team1-box">
          <h2>ãƒãƒ¼ãƒ 1</h2>
          <p class="kills">ã‚­ãƒ«æ•°ï¼š<span id="teamA-kills"></span></p>
          <ul id="teamA-players" class="player-list"></ul>
        </div>
        <div class="team-box team2" id="team2-box">
          <h2>ãƒãƒ¼ãƒ 2</h2>
          <p class="kills">ã‚­ãƒ«æ•°ï¼š<span id="teamB-kills"></span></p>
          <ul id="teamB-players" class="player-list"></ul>
        </div>
      </div>
    </div>
    <div class="navigation-buttons">
      <button onclick="navigateMatch('previous')" id="prev-btn">å‰ã®è©¦åˆ</button>
      <button onclick="navigateMatch('next')" id="next-btn">æ¬¡ã®è©¦åˆ</button>
    </div>
  </div>

  <script>
    // --- Firebase è¨­å®š (å…¥åŠ›ãƒšãƒ¼ã‚¸ã¨åŒä¸€) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBbHLIr4GWkZ3Mfbg3M8wOY68X1ITrE-yw",
      authDomain: "match-result-ea475.firebaseapp.com",
      databaseURL: "https://match-result-ea475-default-rtdb.firebaseio.com",
      projectId: "match-result-ea475",
      storageBucket: "match-result-ea475.firebasestorage.app",
      messagingSenderId: "759877853492",
      appId: "1:759877853492:web:a10935960bf8230af90561"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allMatches = [];
    let currentMatchIndex = -1;
    let autoUpdateEnabled = true;

    const autoUpdateCheckbox = document.getElementById("auto-update-checkbox");

    // --- è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åŒæœŸã™ã‚‹ ---
    db.ref("apex_results").orderByChild("matchNumber").on("value", (snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        allMatches = Object.values(data);
        allMatches.sort((a, b) => a.matchNumber - b.matchNumber);

        // æœ€æ–°ã®è©¦åˆã‚’è¦‹ã‚‹è¨­å®šãŒæœ‰åŠ¹ãªå ´åˆã€æœ€æ–°ã®è©¦åˆã‚’è¡¨ç¤º
        if (autoUpdateEnabled) {
          currentMatchIndex = allMatches.length - 1;
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’å†æç”»
        displayMatch(currentMatchIndex);
      } else {
        allMatches = [];
        currentMatchIndex = -1;
        document.getElementById("loading-status").innerText = "ä¿å­˜ã•ã‚ŒãŸè©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
        document.getElementById("match-view").style.display = "none";
      }
      document.getElementById("loading-status").style.display = "none";
      document.getElementById("match-view").style.display = "block";
    });

    // --- æœ€æ–°ã®è©¦åˆã‚’è¦‹ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    autoUpdateCheckbox.addEventListener('change', () => {
      autoUpdateEnabled = autoUpdateCheckbox.checked;
      if (autoUpdateEnabled) {
        // ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚ŒãŸã‚‰æœ€æ–°ã®è©¦åˆã«ç§»å‹•
        currentMatchIndex = allMatches.length - 1;
        displayMatch(currentMatchIndex);
      }
    });

    // --- è©¦åˆç•ªå·ã‹ã‚‰è©¦åˆã‚’è¡¨ç¤ºã™ã‚‹ ---
    function goToMatchNumber() {
      const inputNumber = Number(document.getElementById("match-no-input").value);
      const index = allMatches.findIndex(match => match.matchNumber === inputNumber);
      if (index !== -1) {
        currentMatchIndex = index;
        displayMatch(currentMatchIndex);
        // æ‰‹å‹•ã§è©¦åˆã‚’åˆ‡ã‚Šæ›¿ãˆãŸã®ã§è‡ªå‹•æ›´æ–°ã‚’ç„¡åŠ¹åŒ–
        autoUpdateEnabled = false;
        autoUpdateCheckbox.checked = false;
      } else {
        alert("æŒ‡å®šã•ã‚ŒãŸè©¦åˆç•ªå·ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      }
    }

    // --- è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ ---
    function displayMatch(index) {
      if (index >= 0 && index < allMatches.length) {
        const match = allMatches[index];
        document.getElementById("match-no").innerText = match.matchNumber;
        document.getElementById("teamA-kills").innerText = match.teamAKills;
        document.getElementById("teamB-kills").innerText = match.teamBKills;
        renderPlayers("teamA-players", match.teamA);
        renderPlayers("teamB-players", match.teamB);

        // å‹æ•—ã®è¡¨ç¤º
        const team1Box = document.getElementById("team1-box");
        const team2Box = document.getElementById("team2-box");

        // å‹æ•—è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
        team1Box.classList.remove("winner");
        team2Box.classList.remove("winner");
        const existingMarks = document.querySelectorAll(".winner-mark");
        existingMarks.forEach(mark => mark.remove());

        if (match.teamAKills > match.teamBKills) {
          team1Box.classList.add("winner");
          team1Box.insertAdjacentHTML('beforeend', '<div class="winner-mark">ğŸ†</div>');
        } else if (match.teamBKills > match.teamAKills) {
          team2Box.classList.add("winner");
          team2Box.insertAdjacentHTML('beforeend', '<div class="winner-mark">ğŸ†</div>');
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
        document.getElementById("prev-btn").disabled = index === 0;
        document.getElementById("next-btn").disabled = index === allMatches.length - 1;
        
        // å…¥åŠ›æ¬„ã«ç¾åœ¨ã®è©¦åˆç•ªå·ã‚’åæ˜ 
        document.getElementById("match-no-input").value = match.matchNumber;

        // æœ€æ–°ã®è©¦åˆã‚’è¦‹ã¦ã„ã‚‹å ´åˆã®ã¿ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹
        if (index === allMatches.length - 1) {
          autoUpdateEnabled = true;
          autoUpdateCheckbox.checked = true;
        }
      }
    }

    // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹ ---
    function renderPlayers(elementId, players) {
      const ul = document.getElementById(elementId);
      ul.innerHTML = "";
      players.forEach(player => {
        const li = document.createElement("li");
        li.innerText = player;
        ul.appendChild(li);
      });
    }

    // --- è©¦åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ ---
    function navigateMatch(direction) {
      if (direction === "next" && currentMatchIndex < allMatches.length - 1) {
        currentMatchIndex++;
      } else if (direction === "previous" && currentMatchIndex > 0) {
        currentMatchIndex--;
      }
      displayMatch(currentMatchIndex);
      // æ‰‹å‹•ã§è©¦åˆã‚’åˆ‡ã‚Šæ›¿ãˆãŸã®ã§è‡ªå‹•æ›´æ–°ã‚’ç„¡åŠ¹åŒ–
      autoUpdateEnabled = false;
      autoUpdateCheckbox.checked = false;
    }
  </script>
</body>

</html>
