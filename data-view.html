<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚«ã‚¹ã‚¿ãƒ çµæœé–²è¦§ãƒšãƒ¼ã‚¸</title>
  <style>
     body {
      font-family: "Hiragino Maru Gothic ProN", sans-serif;
      background: #f7fcfc;
      margin: 0;
      padding-top: 100px;
    }

    .container {
      max-width: 500px;
      margin: 30px auto;
      background: none;
      box-shadow: none;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

   h1 {
      text-align: center;
      color: #47b6a2;
    }
    
        header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #97EADB;
      padding: 1rem;
      text-align: center;
      z-index: 1000;
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
      color: #fff;
    }

    /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .hamburger {
      font-size: 2rem;
      cursor: pointer;
      position: absolute;
      top: 50%;
      right: 3rem;
      color: white;
      transform: translateY(-50%);
      z-index: 1100;
    }

    nav {
      position: fixed;
      top: -100%;
      left: 0;
      width: 100%;
      background-color: #97EADB;
      display: flex;
      flex-direction: column;
      padding: 0;
      transition: top 0.3s ease;
      z-index: 1050;
    }

    nav.show {
      top: 75px;
    }

    nav a {
      display: block;
      text-align: center;
      margin: 0;
      padding: 0.6rem 0;
      font-size: 1.2rem;
      font-weight: bold;
      color: white;
      background-color: #97eadb;
      border-bottom: 1px solid #97EADB;
      text-decoration: none;
      transition: background-color 0.2s, transform 0.2s;
    }

    nav a:hover {
      background-color: #0099aa;
      transform: scale(1.03);
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    footer {
      background: #97EADB;
      text-align: center;
      color: white;
      padding: 1rem;
      margin-top: 2rem;
    }

    .match-search {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .match-search input {
      width: 80px;
      padding: 8px;
      border: 1px solid #97eadb;
      border-radius: 6px;
      text-align: center;
    }

    .match-search button {
      padding: 8px 15px;
      background-color: #97eadb;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .match-search button:hover {
      background-color: #7dd2c3;
    }

    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }

    .navigation-buttons button {
      flex-grow: 1;
      padding: 10px;
      background-color: #97eadb;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .navigation-buttons button:hover {
      background-color: #7dd2c3;
    }

    .teams {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .team-box {
      background: #eefaff;
      padding: 10px;
      border-radius: 8px;
      border: 2px solid #97eadb;
      position: relative;
    }

    .team-box.team2 {
      background: #fff1f5;
      border-color: #ffb6c1;
    }

    .team-box.winner {
      border-color: #ffc107;
      box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }

    .team-box.winner .kills,
    .team-box.winner h2 {
      color: #ffc107;
    }

    .winner-mark {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 24px;
      color: #ffc107;
      font-weight: bold;
    }

    .team-box h2 {
      text-align: center;
      font-size: 16px;
      margin: 0 0 8px 0;
      color: #47b6a2;
    }

    .team-box.team2 h2 {
      color: #ffb6c1;
    }

    .player-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .player-list li {
      background: #fff;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      padding: 6px;
      text-align: center;
    }

    .kills {
      font-size: 24px;
      font-weight: bold;
      color: #444;
      margin-top: 5px;
    }

    .team-box.team1 h2,
    .team-box.team1 .kills {
      color: #47b6a2;
    }

    .team-box.team2 h2,
    .team-box.team2 .kills {
      color: #ffb6c1;
    }

    .match-number {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    #loading-status {
      text-align: center;
      color: #666;
      margin-top: 20px;
    }

    .auto-update-option {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 5px;
      margin-top: 10px;
      margin-bottom: 10px; /* ã“ã“ã‚’å¤‰æ›´ */
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body>
    <header>
    <h1>ãƒ‰å¤©ç„¶ã®ãã‚ƒãŸã‚“</h1>
    <div class="hamburger" id="hamburger">â˜°</div>
    <nav id="nav">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="roulette.html">ã‚¤ãƒ™ãƒ³ãƒˆ</a>
      <a href="team-view.html">ãƒãƒ¼ãƒ åˆ†ã‘ã‚’è¦‹ã‚‹</a>
    </nav>
  </header>
  <div class="container">
    <h1>è©¦åˆçµæœé–²è¦§</h1>

    <div class="match-search">
      <label for="match-no-input">è©¦åˆç•ªå·ï¼š</label>
      <input type="number" id="match-no-input" placeholder="ç•ªå·ã‚’å…¥åŠ›" min="1" />
      <button onclick="goToMatchNumber()">è¡¨ç¤º</button>
    </div>

    <div class="auto-update-option">
      <label for="auto-update-checkbox">æœ€æ–°ã®è©¦åˆã‚’è¦‹ã‚‹</label>
      <input type="checkbox" id="auto-update-checkbox" checked>
    </div>
    
    <div class="navigation-buttons">
      <button onclick="navigateMatch('previous')" id="prev-btn">å‰ã®è©¦åˆ</button>
      <button onclick="navigateMatch('next')" id="next-btn">æ¬¡ã®è©¦åˆ</button>
    </div>

    <div id="loading-status">è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="match-view" style="display: none;">
      <div class="teams">
        <div class="team-box team1" id="team1-box">
          <h2>ãƒãƒ¼ãƒ 1</h2>
          <p class="kills">ã‚­ãƒ«æ•°ï¼š<span id="teamA-kills"></span></p>
          <ul id="teamA-players" class="player-list"></ul>
        </div>
        <div class="team-box team2" id="team2-box">
          <h2>ãƒãƒ¼ãƒ 2</h2>
          <p class="kills">ã‚­ãƒ«æ•°ï¼š<span id="teamB-kills"></span></p>
          <ul id="teamB-players" class="player-list"></ul>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <p>ãƒ‰å¤©ç„¶ã®ãã‚ƒãŸã‚“</p>
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBbHLIr4GWkZ3Mfbg3M8wOY68X1ITrE-yw",
      authDomain: "match-result-ea475.firebaseapp.com",
      databaseURL: "https://match-result-ea475-default-rtdb.firebaseio.com",
      projectId: "match-result-ea475",
      storageBucket: "match-result-ea475.firebasestorage.app",
      messagingSenderId: "759877853492",
      appId: "1:759877853492:web:a10935960bf8230af90561"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allMatches = [];
    let playerReadings = {}; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®èª­ã¿æ–¹ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹
    let currentMatchIndex = -1;
    let autoUpdateEnabled = true;

    const autoUpdateCheckbox = document.getElementById("auto-update-checkbox");

    // --- ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ã§å–å¾—ã™ã‚‹
    Promise.all([
      db.ref("apex_results").orderByChild("matchNumber").once("value"),
      db.ref("player_readings").once("value")
    ]).then(snapshots => {
      const resultsSnapshot = snapshots[0];
      const readingsSnapshot = snapshots[1];
      
      if (resultsSnapshot.exists()) {
        const data = resultsSnapshot.val();
        allMatches = Object.values(data);
        allMatches.sort((a, b) => a.matchNumber - b.matchNumber);
      }
      
      if (readingsSnapshot.exists()) {
        playerReadings = readingsSnapshot.val();
      }

      if (allMatches.length > 0) {
        currentMatchIndex = allMatches.length - 1;
        displayMatch(currentMatchIndex);
      } else {
        document.getElementById("loading-status").innerText = "ä¿å­˜ã•ã‚ŒãŸè©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
      }

      document.getElementById("loading-status").style.display = "none";
      document.getElementById("match-view").style.display = "block";

      // ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’ç›£è¦–
      db.ref("apex_results").orderByChild("matchNumber").on("value", updatePage);
      db.ref("player_readings").on("value", updatePage);
    }).catch(error => {
      console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
      document.getElementById("loading-status").innerText = "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    });

    // --- ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePage(snapshot) {
      if (snapshot.ref.key === "apex_results") {
        if (snapshot.exists()) {
          allMatches = Object.values(snapshot.val());
          allMatches.sort((a, b) => a.matchNumber - b.matchNumber);
        } else {
          allMatches = [];
        }
      } else if (snapshot.ref.key === "player_readings") {
        playerReadings = snapshot.val() || {};
      }

      if (autoUpdateEnabled) {
        currentMatchIndex = allMatches.length - 1;
      }
      
      displayMatch(currentMatchIndex);
    }

    // --- æœ€æ–°ã®è©¦åˆã‚’è¦‹ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    autoUpdateCheckbox.addEventListener('change', () => {
      autoUpdateEnabled = autoUpdateCheckbox.checked;
      if (autoUpdateEnabled) {
        currentMatchIndex = allMatches.length - 1;
        displayMatch(currentMatchIndex);
      }
    });

    // --- è©¦åˆç•ªå·ã‹ã‚‰è©¦åˆã‚’è¡¨ç¤ºã™ã‚‹ ---
    function goToMatchNumber() {
      const inputNumber = Number(document.getElementById("match-no-input").value);
      const index = allMatches.findIndex(match => match.matchNumber === inputNumber);
      if (index !== -1) {
        currentMatchIndex = index;
        displayMatch(currentMatchIndex);
        autoUpdateEnabled = false;
        autoUpdateCheckbox.checked = false;
      } else {
        alert("æŒ‡å®šã•ã‚ŒãŸè©¦åˆç•ªå·ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      }
    }

    // --- è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ ---
    function displayMatch(index) {
      if (index >= 0 && index < allMatches.length) {
        const match = allMatches[index];
        document.getElementById("match-no-input").value = match.matchNumber;

        document.getElementById("teamA-kills").innerText = match.teamAKills;
        document.getElementById("teamB-kills").innerText = match.teamBKills;
        
        const sortedTeamA = [...match.teamA].sort((a, b) => {
          const readingA = playerReadings[a]?.reading || a;
          const readingB = playerReadings[b]?.reading || b;
          return readingA.localeCompare(readingB, 'ja', { sensitivity: 'base' });
        });

        const sortedTeamB = [...match.teamB].sort((a, b) => {
          const readingA = playerReadings[a]?.reading || a;
          const readingB = playerReadings[b]?.reading || b;
          return readingA.localeCompare(readingB, 'ja', { sensitivity: 'base' });
        });
        
        renderPlayers("teamA-players", sortedTeamA);
        renderPlayers("teamB-players", sortedTeamB);

        const team1Box = document.getElementById("team1-box");
        const team2Box = document.getElementById("team2-box");

        team1Box.classList.remove("winner");
        team2Box.classList.remove("winner");
        const existingMarks = document.querySelectorAll(".winner-mark");
        existingMarks.forEach(mark => mark.remove());

        if (match.teamAKills > match.teamBKills) {
          team1Box.classList.add("winner");
          team1Box.insertAdjacentHTML('beforeend', '<div class="winner-mark">ğŸ†</div>');
        } else if (match.teamBKills > match.teamAKills) {
          team2Box.classList.add("winner");
          team2Box.insertAdjacentHTML('beforeend', '<div class="winner-mark">ğŸ†</div>');
        }

        document.getElementById("prev-btn").disabled = index === 0;
        document.getElementById("next-btn").disabled = index === allMatches.length - 1;
        
        if (index === allMatches.length - 1) {
          autoUpdateEnabled = true;
          autoUpdateCheckbox.checked = true;
        }
      }
    }

    // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹ ---
    function renderPlayers(elementId, players) {
      const ul = document.getElementById(elementId);
      ul.innerHTML = "";
      players.forEach(player => {
        const li = document.createElement("li");
        li.innerText = player;
        ul.appendChild(li);
      });
    }

    // --- è©¦åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ ---
    function navigateMatch(direction) {
      if (direction === "next" && currentMatchIndex < allMatches.length - 1) {
        currentMatchIndex++;
      } else if (direction === "previous" && currentMatchIndex > 0) {
        currentMatchIndex--;
      }
      displayMatch(currentMatchIndex);
      autoUpdateEnabled = false;
      autoUpdateCheckbox.checked = false;
    }
  </script>
</body>

</html>
