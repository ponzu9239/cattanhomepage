<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Åç„ÇÉ„Åü„Çì„ÅÆAPEX„Éì„É≥„Ç¥</title>
<link rel="stylesheet" href="common.css">
<style>
  body {
    background-color: #97eadb;
    text-align: center;
    font-family: sans-serif;
  }
  .bingo-card-section {
    position: relative;
    display: inline-block;
    margin-top: 20px;
  }
  .bingo-card {
    display: grid;
    grid-template-columns: repeat(3, 80px);
    grid-template-rows: repeat(3, 80px);
    gap: 5px;
    position: relative;
    margin: 0 auto;
  }
  .bingo-card div {
    width: 80px;
    height: 80px;
    border: 2px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    background: white;
    transition: background 0.3s;
  }
  .bingo-card .highlight {
    background-color: #ffb84d !important;
  }
  .bingo-line {
    position: absolute;
    background-color: #ff66b2;
    height: 6px;
    border-radius: 3px;
    transform-origin: center center;
    z-index: 10;
  }
  #numberInput {
    display: block;
    margin: 20px auto;
    font-size: 18px;
    padding: 8px;
    width: 200px;
    text-align: center;
  }
</style>
</head>
<body>
  <main>
    <section class="bingo-card-section">
      <h1 class="page-title">APEX„Éì„É≥„Ç¥ üéØ</h1>
      <div id="bingoCard" class="bingo-card"></div>
    </section>

    <input type="text" id="numberInput" placeholder="Áï™Âè∑„ÇíÂÖ•Âäõ (‰æã: 123)">
  </main>

  <script>
    const bingoCard = document.getElementById('bingoCard');
    const numberInput = document.getElementById('numberInput');

    // „É©„É≥„ÉÄ„É†ÈÖçÁΩÆ
    const numbers = [...Array(9)].map((_, i) => i + 1).sort(() => Math.random() - 0.5);
    numbers.forEach(num => {
      const cell = document.createElement('div');
      cell.textContent = num;
      bingoCard.appendChild(cell);
    });

    function clearHighlights() {
      document.querySelectorAll('.bingo-card div').forEach(c => c.classList.remove('highlight'));
      document.querySelectorAll('.bingo-line').forEach(l => l.remove());
    }

    function highlightNumbers(nums) {
      document.querySelectorAll('.bingo-card div').forEach(cell => {
        if (nums.includes(parseInt(cell.textContent))) {
          cell.classList.add('highlight');
        }
      });
    }

    function checkBingo() {
      const cells = Array.from(document.querySelectorAll('.bingo-card div'));
      const matrix = Array.from({length: 3}, (_, r) => cells.slice(r * 3, r * 3 + 3));
      const highlights = cells.map(c => c.classList.contains('highlight'));

      const lines = [
        [0,1,2], [3,4,5], [6,7,8], // Ê®™
        [0,3,6], [1,4,7], [2,5,8], // Á∏¶
        [0,4,8], [2,4,6]           // Êñú„ÇÅ
      ];

      lines.forEach((line, idx) => {
        if (line.every(i => highlights[i])) {
          drawBingoLine(idx);
        }
      });
    }

    function drawBingoLine(index) {
      const line = document.createElement('div');
      line.classList.add('bingo-line');
      const cardRect = bingoCard.getBoundingClientRect();
      const size = 80 * 3 + 5 * 2; // ÂÖ®‰Ωì„ÅÆ„Çµ„Ç§„Ç∫
      const offset = 40; // ‰∏≠ÂøÉ„ÇíÈÄö„Åô„Åü„ÇÅ

      if (index <= 2) { // Ê®™
        line.style.width = size + 30 + 'px';
        line.style.left = '-15px';
        line.style.top = (index * 85 + offset - 3) + 'px';
      } else if (index <= 5) { // Á∏¶
        line.style.width = size + 30 + 'px';
        line.style.left = '50%';
        line.style.top = '-15px';
        line.style.transform = `translateX(-50%) rotate(90deg) translateY(${(index - 3) * 85 - 127}px)`;
      } else if (index === 6) { // Êñú„ÇÅÂ∑¶‰∏ä‚ÜíÂè≥‰∏ã
        line.style.width = size * 1.4 + 'px';
        line.style.left = '-15px';
        line.style.top = '50%';
        line.style.transform = 'translateY(-50%) rotate(45deg)';
      } else if (index === 7) { // Êñú„ÇÅÂè≥‰∏ä‚ÜíÂ∑¶‰∏ã
        line.style.width = size * 1.4 + 'px';
        line.style.left = '-15px';
        line.style.top = '50%';
        line.style.transform = 'translateY(-50%) rotate(-45deg)';
      }

      bingoCard.appendChild(line);
    }

    numberInput.addEventListener('input', () => {
      clearHighlights();
      const inputVal = numberInput.value.replace(/[^0-9]/g, '');
      const nums = inputVal.split('').map(n => parseInt(n));
      highlightNumbers(nums);
      checkBingo();
    });
  </script>
</body>
</html>