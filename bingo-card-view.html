<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リアルタイムビンゴ表示</title>
<link rel="stylesheet" href="common.css">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <div id="header-placeholder"></div>

  <main>
    <section class="bingo-card-section">
      <h2 class="page-title">リアルタイムビンゴ</h2>

      <div id="bingoCard" class="bingo-card">
        <!-- 3×3の数字セル -->
      </div>

      <div class="timestamp" id="cardTimestamp"></div>
    </section>
  </main>

  <div id="footer-placeholder"></div>

  <script src="common.js"></script>
  <script>
    setupHeader('header-user.html');

    // Firebase 初期化
    const firebaseConfig = {
      apiKey: "AIzaSyBWaCw2nAEh6FbYbteNk_fBSqPBTZ_UhC8",
      authDomain: "catiffanygame.firebaseapp.com",
      databaseURL: "https://catiffanygame-default-rtdb.firebaseio.com",
      projectId: "catiffanygame",
      storageBucket: "catiffanygame.firebasestorage.app",
      messagingSenderId: "166871605809",
      appId: "1:166871605809:web:1fe6e874fa06005ec46b10",
      measurementId: "G-ZNGEZZWMTP"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const bingoCardRef = db.ref('bingoCard'); // Realtime DB のパス

    const bingoCard = document.getElementById('bingoCard');
    const cardTimestamp = document.getElementById('cardTimestamp');

    // 3x3のセルを生成
    function createCells() {
        bingoCard.innerHTML = '';
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.textContent = '-';
            bingoCard.appendChild(cell);
        }
    }

    // Firebaseのデータをリアルタイムで反映
    bingoCardRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        const numbers = data.numbers || [];
        const timestamp = data.timestamp || '';

        bingoCard.querySelectorAll('div').forEach((cell, i) => {
            cell.textContent = numbers[i] !== undefined ? numbers[i] : '-';
        });

        cardTimestamp.textContent = timestamp;
    });

    // 初期化
    createCells();
  </script>
</body>
</html>