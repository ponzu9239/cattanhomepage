// ✅ 平均キル差スコア
function calculateDiffScore(matches) {
  const playerStats = {};

  matches.forEach(match => {
    if(!match.teamA || !match.teamB) return;

    const teamAScore = match.teamAKills;
    const teamBScore = match.teamBKills;
    const teamASize = match.teamA.length;
    const teamBSize = match.teamB.length;

    const teamAWins = teamAScore > teamBScore;
    const teamBWins = teamBScore > teamAScore;

    const multiplierA = teamAWins ? (teamBSize / teamASize) : (teamASize / teamBSize);
    const diffA = (teamAScore - teamBScore) * multiplierA;

    const multiplierB = teamBWins ? (teamASize / teamBSize) : (teamBSize / teamASize);
    const diffB = (teamBScore - teamAScore) * multiplierB;

    // Aチーム
    match.teamA.forEach(p => {
      if (!playerStats[p]) playerStats[p] = { total: 0, count: 0 };
      playerStats[p].total += diffA;
      playerStats[p].count++;
    });

    // Bチーム
    match.teamB.forEach(p => {
      if (!playerStats[p]) playerStats[p] = { total: 0, count: 0 };
      playerStats[p].total += diffB;
      playerStats[p].count++;
    });
  });

  // ✅ 平均値にして返す
  return Object.keys(playerStats).map(name => ({
    name,
    score: (playerStats[name].total / playerStats[name].count).toFixed(2)
  }));
}